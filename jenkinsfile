node {
    try {
        def buildNum = env.BUILD_NUMBER 
        def branchName = env.BRANCH_NAME
        registry = "shadowlorddocker/pipeline"
        registryCredential = "dckr_pat_29bSbuWczhKyv9EE-kPc5gmicLk"
        echo "Build Number: ${buildNum}"
        echo "Branch Name: ${branchName}"

        stage('Atelier - clone') {
            git branch: 'DEV',
                        credentialsId: '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',
                        url: 'https://github.com/Dialsyp/Atelier.git'
        }

        stage('BUILD') {
            sh "echo 'hello'"
            //dockerImage = docker.build registry + ":$BUILD_NUMBER"
        }

        stage('PUSH') {
            sh "echo 'hello'"
            //docker.withRegistry( '', registryCredential ) {
            //dockerImage.push()
        }
        stage('ANSIBLE - Deploy'){
            git branch: 'main', url: 'https://github.com/Dialsyp/ansible.git'
            sh "ls"
            ansiblePlaybook(
                        inventory: 'inventory.yml',
                        playbook: 'ping.yml'
                    )
        }
    }
    finally {
        // cleanWs() is not needed here, as it was already called at the beginning
    }
}